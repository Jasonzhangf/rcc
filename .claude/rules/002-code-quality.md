# 规则 #002: 代码质量标准

## 🎯 规则概述

**所有代码必须符合高质量标准，确保可维护性、可测试性和可读性。**

## 📋 基本要求

### 编译和测试
- [ ] **必须编译成功** - 代码必须能够成功编译
- [ ] **通过所有测试** - 不得破坏现有测试
- [ ] **包含新测试** - 新功能必须有对应测试
- [ ] **遵循代码风格** - 必须使用项目规定的代码格式

### 代码审查
- [ ] **自我审查** - 提交前必须自我检查代码
- [ ] **明确提交信息** - 提交消息必须说明"为什么"而不是"做了什么"
- [ ] **小批量提交** - 每次提交应该是一个逻辑完整的小功能
- [ ] **及时审查** - 代码审查应该在24小时内完成

## 🏗️ 架构原则

### 设计原则
- **单一职责** - 每个函数/类应该只有一个职责
- **依赖注入** - 使用依赖注入而非硬编码依赖
- **接口优先** - 定义接口而不是具体实现
- **显式依赖** - 清晰的数据流和依赖关系

### 避免的模式
- ❌ 过早抽象 - 不要为不存在的需求设计复杂架构
- ❌ 聪明的代码 - 选择无聊且明显的解决方案
- ❌ 重复代码 - 及时重构重复逻辑
- ❌ 深层嵌套 - 保持代码结构扁平

## 📝 代码风格

### TypeScript/JavaScript
- 使用有意义的变量和函数名
- 函数长度不超过50行
- 类的职责明确且简洁
- 错误处理要具体且有用

### 文件组织
- 一个文件只导出一个主要类/功能
- 相关的辅助函数可以放在同一文件
- 使用清晰的目录结构
- 文件名要反映其内容

## 🧪 测试标准

### 测试覆盖
- 新功能必须有单元测试
- 关键路径必须有集成测试
- 测试必须覆盖错误情况
- 测试代码必须与生产代码同样严格

### 测试质量
- 测试应该快速且可靠
- 测试应该独立运行
- 测试应该有清晰的描述
- 避免测试实现细节

## 🔍 错误处理

### 错误处理原则
- **快速失败** - 遇到错误时立即失败
- **具体错误** - 提供具体的错误信息和上下文
- **适当层级** - 在合适的层级处理错误
- **不要静默** - 不要静默地忽略异常

### 错误处理模式
```typescript
// ✅ 正确：具体的错误信息
function processData(data: any): Result {
  if (!data) {
    throw new Error('ProcessData: data is required but received undefined');
  }
  // 处理逻辑
}

// ❌ 错误：模糊的错误信息
function processData(data: any): Result {
  if (!data) {
    throw new Error('Error occurred');
  }
}
```

## 📊 性能考虑

### 性能原则
- 不要过早优化
- 优化基于实际的性能分析
- 考虑时间和空间复杂度
- 避免不必要的计算和内存使用

### 内存管理
- 及时释放不再需要的资源
- 避免内存泄漏
- 注意循环引用
- 合理使用缓存

## 🔧 开发工具

### 必须使用的工具
- **TypeScript** - 类型检查和编译
- **ESLint** - 代码规范检查
- **Prettier** - 代码格式化
- **Jest** - 单元测试
- **Git** - 版本控制

### 推荐的扩展
- 编辑器的TypeScript支持
- GitLens用于Git操作
- 错误高亮和智能提示

## 📋 提交检查清单

### 提交前检查
- [ ] 代码编译成功
- [ ] 所有测试通过
- [ ] 代码格式正确
- [ ] 没有linting错误
- [ ] 新功能有测试覆盖
- [ ] 提交信息清晰明确
- [ ] 没有包含调试代码
- [ ] 没有敏感信息

### 代码审查检查
- [ ] 代码符合项目架构
- [ ] 逻辑清晰且正确
- [ ] 错误处理完善
- [ ] 性能考虑充分
- [ ] 测试覆盖完整
- [ ] 文档更新及时

## 🚨 质量门禁

### 阻止发布的问题
- 编译失败
- 测试失败
- 安全漏洞
- 性能回归
- 关键功能缺失

### 需要关注的问题
- 代码复杂度过高
- 测试覆盖率低
- 技术债务积累
- 文档不完整

## 📈 持续改进

### 代码质量度量
- 代码覆盖率
- 复杂度指标
- 技术债务指标
- 团队满意度

### 定期审查
- 每月代码质量回顾
- 每季度架构审查
- 每半年技术债务清理
- 年度技术栈评估

---

**规则版本：** 1.0  
**最后更新：** 2024-09-11  
**维护者：** RCC开发团队