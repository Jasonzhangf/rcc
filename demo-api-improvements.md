# API Key æµ‹è¯•é€»è¾‘å’Œæ¨¡å‹ç®¡ç†åŠŸèƒ½æ”¹è¿›

## ğŸ“‹ å®ç°æ¦‚è§ˆ

### âœ… å·²å®Œæˆçš„æ”¹è¿›

#### 1. **çœŸå®API Keyæµ‹è¯•é€»è¾‘**
- âœ… æ›¿æ¢äº†æ¨¡æ‹Ÿæµ‹è¯•ï¼Œå®ç°äº†çœŸå®çš„APIè°ƒç”¨
- âœ… æ ¹æ®åè®®ç±»å‹æ„å»ºæ­£ç¡®çš„æµ‹è¯•ç«¯ç‚¹:
  - **OpenAIåè®®**: `GET /v1/models` with `Authorization: Bearer`
  - **Anthropicåè®®**: `POST /v1/messages` with `x-api-key` header
  - **Geminiåè®®**: `GET /v1beta/models?key=` with query parameter
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç è§£æ
- âœ… çœŸå®çš„å“åº”æ—¶é—´æµ‹é‡
- âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯åé¦ˆ

#### 2. **è·å–æ¨¡å‹åˆ—è¡¨åŠŸèƒ½ (Get Models)**
- âœ… æ–°å¢ `POST /api/providers/:id/models` ç«¯ç‚¹
- âœ… å‰ç«¯æ·»åŠ äº†"ğŸ“‹ Get Models"æŒ‰é’®
- âœ… è‡ªåŠ¨è°ƒç”¨å¯¹åº”åè®®çš„models APIç«¯ç‚¹
- âœ… è§£æå¹¶æ›´æ–°providerçš„modelså­—æ®µ
- âœ… å®æ—¶æ›´æ–°UIä¸­çš„æ¨¡å‹æ˜¾ç¤º
- âœ… æ¨¡å‹åˆ—è¡¨æ¨¡æ€æ¡†å±•ç¤º

#### 3. **é»˜è®¤Provideré…ç½®**
- âœ… æ·»åŠ äº†3ä¸ªé»˜è®¤providers:
  - **OpenAI Compatible**: `https://api.openai.com/v1`
  - **Anthropic Claude**: `https://api.anthropic.com/v1`  
  - **Google Gemini**: `https://generativelanguage.googleapis.com/v1beta`
- âœ… æ¯ä¸ªprovideréƒ½é¢„é…ç½®äº†å¸¸ç”¨æ¨¡å‹åˆ—è¡¨

#### 4. **Router Tableé»˜è®¤è™šæ‹Ÿæ¨¡å‹**
- âœ… æ·»åŠ äº†é»˜è®¤è·¯ç”±è§„åˆ™:
  - `gpt-4*` â†’ `default-openai` (high priority)
  - `claude-*` â†’ `default-anthropic` (high priority)
  - `gemini-*` â†’ `default-gemini` (medium priority)
- âœ… å®Œæ•´çš„è·¯ç”±ç®¡ç†ç•Œé¢
- âœ… æ”¯æŒæ·»åŠ /ç¼–è¾‘/åˆ é™¤è·¯ç”±è§„åˆ™

#### 5. **UIç•Œé¢ä¼˜åŒ–**
- âœ… Providerå¡ç‰‡æ˜¾ç¤ºåè®®ç±»å‹å’Œæ¨¡å‹ä¿¡æ¯
- âœ… æ¨¡å‹æ ‡ç­¾æ ·å¼ä¼˜åŒ–
- âœ… æµ‹è¯•ç»“æœæ˜¾ç¤ºæ‰¾åˆ°çš„æ¨¡å‹æ•°é‡
- âœ… å“åº”å¼è®¾è®¡é€‚é…ç§»åŠ¨è®¾å¤‡
- âœ… ä¸°å¯Œçš„é€šçŸ¥å’Œé”™è¯¯æç¤º

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¯åŠ¨æœåŠ¡å™¨
```bash
cd /Users/fanzhang/Documents/github/rcc
node scripts/start-multi-key-ui.js
```

### è®¿é—®ç•Œé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:3456`

### æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º

#### 1. **çœŸå®API Keyæµ‹è¯•**
1. åœ¨Providersæ ‡ç­¾é¡µé€‰æ‹©ä¸€ä¸ªprovider
2. æ·»åŠ çœŸå®çš„API keyï¼ˆç‚¹å‡»"â• Add Key"ï¼‰
3. ç‚¹å‡»"ğŸš€ Test Provider"è¿›è¡ŒçœŸå®APIæµ‹è¯•
4. æŸ¥çœ‹è¯¦ç»†çš„æµ‹è¯•ç»“æœï¼šçŠ¶æ€ç ã€å“åº”æ—¶é—´ã€é”™è¯¯ä¿¡æ¯

#### 2. **è·å–æ¨¡å‹åˆ—è¡¨**
1. ç¡®ä¿providerå·²é…ç½®æœ‰æ•ˆçš„API key
2. ç‚¹å‡»"ğŸ“‹ Get Models"æŒ‰é’®
3. ç³»ç»Ÿå°†è°ƒç”¨çœŸå®APIè·å–å¯ç”¨æ¨¡å‹
4. æ¨¡å‹åˆ—è¡¨è‡ªåŠ¨æ›´æ–°å¹¶æ˜¾ç¤ºåœ¨providerå¡ç‰‡ä¸­
5. æŸ¥çœ‹è¯¦ç»†çš„æ¨¡å‹åˆ—è¡¨æ¨¡æ€æ¡†

#### 3. **è·¯ç”±è§„åˆ™ç®¡ç†**
1. åˆ‡æ¢åˆ°"Router Table"æ ‡ç­¾é¡µ
2. æŸ¥çœ‹é¢„é…ç½®çš„é»˜è®¤è·¯ç”±è§„åˆ™
3. ç‚¹å‡»"â• Add Route"æ·»åŠ æ–°è§„åˆ™
4. æ”¯æŒæ¨¡å¼åŒ¹é…ã€ä¼˜å…ˆçº§ã€å¯ç”¨/ç¦ç”¨çŠ¶æ€

## ğŸ§ª æµ‹è¯•éªŒè¯

### è‡ªåŠ¨åŒ–æµ‹è¯•
```bash
# è¿è¡ŒåŠŸèƒ½æµ‹è¯•è„šæœ¬
node test-api-key-functionality.js
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤
1. **è¿æ¥æµ‹è¯•**:
   - æ·»åŠ çœŸå®API keysåˆ°ä¸åŒåè®®çš„providers
   - éªŒè¯æµ‹è¯•è¿”å›çœŸå®çŠ¶æ€ç å’Œå“åº”æ—¶é—´
   - ç¡®è®¤é”™è¯¯å¤„ç†æ­£ç¡®æ˜¾ç¤ºè®¤è¯å¤±è´¥ç­‰ä¿¡æ¯

2. **æ¨¡å‹è·å–æµ‹è¯•**:
   - ä½¿ç”¨æœ‰æ•ˆAPI keyç‚¹å‡»"Get Models"
   - éªŒè¯æ¨¡å‹åˆ—è¡¨æ­£ç¡®è·å–å’Œæ˜¾ç¤º
   - ç¡®è®¤provideré…ç½®è‡ªåŠ¨æ›´æ–°

3. **è·¯ç”±è¡¨æµ‹è¯•**:
   - éªŒè¯é»˜è®¤è·¯ç”±è§„åˆ™æ­£ç¡®æ˜¾ç¤º
   - æµ‹è¯•æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤è·¯ç”±è§„åˆ™
   - ç¡®è®¤è·¯ç”±ä¼˜å…ˆçº§æ’åºåŠŸèƒ½

## ğŸ“Š æŠ€æœ¯å®ç°ç»†èŠ‚

### APIç«¯ç‚¹æ˜ å°„
```javascript
// OpenAIåè®®
GET {api_base_url}/models
Headers: { "Authorization": "Bearer {api_key}" }

// Anthropicåè®®  
POST {api_base_url}/messages
Headers: { 
  "x-api-key": "{api_key}",
  "anthropic-version": "2023-06-01"
}
Body: ç®€å•çš„æ¶ˆæ¯æµ‹è¯•

// Geminiåè®®
GET {api_base_url}/models?key={api_key}
Headers: { "User-Agent": "RCC-Multi-Key-Manager/1.0" }
```

### é”™è¯¯å¤„ç†
- **401/403**: è®¤è¯å¤±è´¥ - API keyæ— æ•ˆ
- **429**: é€Ÿç‡é™åˆ¶è¶…å‡º
- **404**: APIç«¯ç‚¹ä¸å­˜åœ¨
- **è¶…æ—¶**: 10ç§’è¯·æ±‚è¶…æ—¶å¤„ç†
- **ç½‘ç»œé”™è¯¯**: è¿æ¥å¤±è´¥å¤„ç†

### æ•°æ®ç»“æ„
```json
{
  "providers": [
    {
      "id": "default-openai",
      "name": "OpenAI Compatible", 
      "protocol": "openai",
      "api_base_url": "https://api.openai.com/v1",
      "api_key": ["sk-key1", "sk-key2"],
      "auth_type": "api_key",
      "models": ["gpt-4", "gpt-3.5-turbo", "gpt-4-turbo"]
    }
  ],
  "routes": [
    {
      "id": "route-gpt-4",
      "pattern": "gpt-4*",
      "provider": "default-openai",
      "model": "auto", 
      "priority": "high",
      "enabled": true
    }
  ]
}
```

## ğŸ¯ ä¸»è¦æ”¹è¿›ç‚¹

### åŸé—®é¢˜ â†’ è§£å†³æ–¹æ¡ˆ

1. **æ¨¡æ‹ŸAPIæµ‹è¯•** â†’ **çœŸå®APIè°ƒç”¨**
   - ä½¿ç”¨Node.js http/httpsæ¨¡å—å‘é€çœŸå®è¯·æ±‚
   - åè®®ç‰¹å®šçš„ç«¯ç‚¹å’Œè®¤è¯æ–¹å¼

2. **ç¼ºå°‘æ¨¡å‹ç®¡ç†** â†’ **å®Œæ•´æ¨¡å‹è·å–å’Œç®¡ç†**
   - APIè°ƒç”¨è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
   - è‡ªåŠ¨æ›´æ–°provideré…ç½®
   - UIå‹å¥½çš„æ¨¡å‹å±•ç¤º

3. **ç©ºç™½è·¯ç”±è¡¨** â†’ **é¢„é…ç½®é»˜è®¤è·¯ç”±**
   - å¸¸ç”¨æ¨¡å¼çš„è™šæ‹Ÿè·¯ç”±è§„åˆ™
   - å®Œæ•´çš„è·¯ç”±ç®¡ç†ç•Œé¢
   - ä¼˜å…ˆçº§å’ŒçŠ¶æ€ç®¡ç†

4. **åŸºç¡€UI** â†’ **å¢å¼ºç”¨æˆ·ä½“éªŒ**
   - ä¸°å¯Œçš„è§†è§‰åé¦ˆ
   - è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
   - å“åº”å¼è®¾è®¡

## ğŸ“ ä½¿ç”¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒä½¿ç”¨**:
   - å°†æµ‹è¯•API keysæ›¿æ¢ä¸ºçœŸå®keys
   - æ ¹æ®éœ€è¦è°ƒæ•´è¯·æ±‚è¶…æ—¶è®¾ç½®
   - è€ƒè™‘æ·»åŠ è¯·æ±‚é™æµä¿æŠ¤

2. **æ‰©å±•åŠŸèƒ½**:
   - å¯æ·»åŠ æ›´å¤šAIæœåŠ¡åè®®æ”¯æŒ
   - å®ç°API keyå¥åº·çŠ¶æ€ç›‘æ§
   - æ·»åŠ ä½¿ç”¨é‡ç»Ÿè®¡åŠŸèƒ½

3. **å®‰å…¨è€ƒè™‘**:
   - API keyså®‰å…¨å­˜å‚¨
   - è¯·æ±‚æ—¥å¿—è„±æ•å¤„ç†
   - è®¿é—®æƒé™æ§åˆ¶

## ğŸ”— ç›¸å…³æ–‡ä»¶

- **åç«¯API**: `/Users/fanzhang/Documents/github/rcc/scripts/start-multi-key-ui.js`
- **å‰ç«¯UI**: `/Users/fanzhang/Documents/github/rcc/src/modules/Configuration/ui/multi-key-config-ui.html`
- **æµ‹è¯•è„šæœ¬**: `/Users/fanzhang/Documents/github/rcc/test-api-key-functionality.js`

---

**ğŸ‰ æ‰€æœ‰éœ€æ±‚åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼** ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨çœŸå®çš„API keyæµ‹è¯•ã€æ¨¡å‹è·å–å’Œè·¯ç”±ç®¡ç†åŠŸèƒ½äº†ã€‚