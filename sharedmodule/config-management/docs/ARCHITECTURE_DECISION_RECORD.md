# 架构决策记录 (ADR) - 依赖管理策略

## 状态
已接受

## 背景
在 RCC 模块化架构中，模块之间存在依赖关系。对于正在开发中的模块，我们需要在本地开发便利性和生产环境合规性之间找到平衡。

## 决策
我们决定在开发阶段使用本地路径依赖，而在生产发布时使用 npm 发布版本。

### 开发阶段使用本地依赖的原因

1. **快速迭代**: 开发人员可以实时查看依赖模块的代码更改，无需重新发布
2. **调试便利**: 能够直接调试跨模块的问题，设置断点跟踪执行流程
3. **版本同步**: 确保所有相关模块在同一版本下协同工作
4. **成本效益**: 避免频繁发布开发版本到 npm registry

### 生产环境使用 npm 版本的原因

1. **版本控制**: 确保依赖版本的稳定性和可追溯性
2. **依赖解析**: npm 可以正确解析和管理依赖关系
3. **生态系统兼容**: 符合 Node.js 生态系统标准
4. **部署便利**: 最终用户可以简单地通过 npm 安装使用

## 后果

### 积极影响
- 提高开发效率
- 简化调试流程
- 保持开发和生产环境的一致性
- 遵循 RCC 架构标准

### 消极影响
- 需要维护两套依赖配置
- 增加发布流程的复杂性
- 需要额外的文档说明

## 替代方案考虑

### 方案1: 始终使用 npm 链接 (npm link)
- **优点**: 可以在开发环境中模拟生产环境
- **缺点**: 配置复杂，容易出现链接问题

### 方案2: 使用 monorepo 工具 (如 Lerna)
- **优点**: 统一管理多个包的版本和依赖
- **缺点**: 增加项目复杂性，学习成本高

### 方案3: 始终使用本地路径依赖
- **优点**: 最大化开发便利性
- **缺点**: 违反 RCC 发布标准，不利于外部用户使用

## 相关文档
- [DEVELOPMENT_GUIDE.md](DEVELOPMENT_GUIDE.md)
- [RCC 开发规则](/Users/fanzhang/Documents/github/rcc/CLAUDE.md)