# BaseModule 90%+ 覆盖率测试策略

## 🎯 目标
将 BaseModule.ts 的测试覆盖率从 48.79% 提升到 90% 以上

## 🔍 当前未覆盖区域分析

### 区域 1: 静态工厂方法 (Line 176)
```typescript
static createInstance<T extends BaseModule>(this: new (info: ModuleInfo) => T, info: ModuleInfo): T {
  return new this(info);  // Line 176 - 未覆盖
}
```

### 区域 2: 核心方法实现 (Lines 351-580)
包括：
- 配置管理方法
- 初始化逻辑分支
- 连接验证和管理
- 数据传输异常处理
- 销毁方法完整流程

### 区域 3: 消息处理系统 (Lines 646-737)  
包括：
- sendMessage 异常处理
- sendRequest 超时和错误处理
- sendRequestAsync 回调处理
- 消息广播和处理

## 📋 详细测试计划

### 1. 静态工厂方法覆盖 (Line 176)
**测试用例**:
- 创建不同类型模块实例
- 验证类型推断正确性
- 验证传递的模块信息正确性

### 2. 配置管理完整覆盖 (Lines 351-360)
**测试用例**:
- 配置后初始化保护 (Line 351-353)
- 配置对象深度克隆 (Line 355)
- 配置状态标记 (Line 356)
- 配置调试日志 (Line 358-359)

### 3. 初始化方法分支覆盖 (Lines 382-394)
**测试用例**:
- 无配置初始化警告 (Line 383-385)
- 已配置正常初始化 (Line 387-394)
- 消息中心注册验证 (Line 388)
- 初始化状态设置 (Line 391)
- 初始化日志记录 (Line 393-394)

### 4. 连接管理异常路径 (Lines 401-433)
**测试用例**:
- 连接类型验证异常 (Lines 402-404, 413-415)
- 连接添加和移除边界 (Lines 423-433)
- 空连接列表处理 (Lines 439-449)

### 5. 数据验证和传输 (Lines 456-582)
**测试用例**:
- 各种验证规则测试 (Lines 456-506)
- 数据传输异常处理 (Lines 529-582)
- 空数据传输 (Lines 529-582)
- 特定连接传输 (Lines 533-543)

### 6. 销毁方法完整覆盖 (Lines 587-606)
**测试用例**:
- 连接清理 (Lines 588-590)
- 状态重置 (Lines 591-593)
- 消息中心注销 (Line 596)
- 日志清理 (Line 599)
- 请求清理 (Line 602)
- 销毁日志 (Line 604-605)

### 7. 调试系统完整覆盖 (Lines 202-341)
**测试用例**:
- 调试禁用 (Line 204)
- 级别过滤 (Lines 206-210)
- 日志条目创建 (Lines 212-224)
- 数据附加 (Lines 221-224)
- 堆栈跟踪 (Lines 226-235)
- 日志存储 (Lines 237-243)
- 控制台输出 (Lines 245-264)
- 各级日志 (Lines 272-314)

### 8. 消息系统完整覆盖 (Lines 617-737)
**测试用例**:
- 消息发送异常 (Lines 637-647)
- 请求发送超时 (Lines 684-693)
- 异步请求回调 (Lines 729-738)
- 消息广播 (Lines 749-757)
- 消息处理 (Lines 765-789)
- 生命周期事件 (Lines 795-805)

## 🧪 测试实现策略

### 真实集成测试方法
1. **创建真实模块实例** - 不使用mock
2. **使用实际MessageCenter** - 真实消息传递
3. **完整生命周期测试** - 创建→配置→初始化→使用→销毁
4. **多模块交互测试** - 模块间真实通信

### 测试用例优先级
1. **高优先级**: 核心未覆盖区域
2. **中优先级**: 异常路径和边界条件
3. **低优先级**: 现有已覆盖区域的深度测试

## 📊 覆盖率提升路线图

### 阶段 1: 核心方法覆盖 (预计提升30%)
- 静态工厂方法
- 配置管理
- 初始化和销毁

### 阶段 2: 通信系统覆盖 (预计提升25%)
- 消息发送和处理
- 数据传输
- 生命周期事件

### 阶段 3: 调试和验证覆盖 (预计提升15%)
- 调试日志系统
- 数据验证规则
- 异常路径处理

## ✅ 质量保证标准

### 测试完整性要求
- [ ] 每个公共方法至少3个测试用例
- [ ] 每个分支条件都有对应测试
- [ ] 每个异常路径都有处理测试
- [ ] 每个集成点都有真实测试

### 覆盖率验证标准
- [ ] 语句覆盖率 ≥ 90%
- [ ] 分支覆盖率 ≥ 90%
- [ ] 函数覆盖率 ≥ 90%
- [ ] 行覆盖率 ≥ 90%